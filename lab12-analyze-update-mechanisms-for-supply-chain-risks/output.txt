Lab 12: Analyze Update Mechanisms for Supply Chain Risks
Environment: Ubuntu 24.04 LTS
User: toor

------------------------------------------------------------
Step 1: Create Working Directory
------------------------------------------------------------
toor@ip-172-31-10-207:~$ mkdir -p ~/supply-chain-lab
toor@ip-172-31-10-207:~$ cd ~/supply-chain-lab
toor@ip-172-31-10-207:~/supply-chain-lab$ pwd
/home/toor/supply-chain-lab

------------------------------------------------------------
Step 2: Examine APT Configuration
------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ cat /etc/apt/sources.list
# See /etc/apt/sources.list.d/ubuntu.sources for the canonical configuration.
# This file is present for compatibility and lab auditing.

deb http://archive.ubuntu.com/ubuntu noble main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu noble-updates main restricted universe multiverse
deb http://security.ubuntu.com/ubuntu noble-security main restricted universe multiverse

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ ls -la /etc/apt/sources.list.d/
total 20
drwxr-xr-x 2 root root 4096 Feb 21 12:06 .
drwxr-xr-x 8 root root 4096 Feb 21 11:52 ..
-rw-r--r-- 1 root root  342 Feb 21 11:52 ubuntu.sources
-rw-r--r-- 1 root root  114 Feb 21 11:53 thirdparty.list
-rw-r--r-- 1 root root  203 Feb 21 11:52 microsoft-prod.list

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ sudo apt-key list
Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).

/etc/apt/trusted.gpg.d/ubuntu-keyring-2012-cdimage.gpg
------------------------------------------------------
pub   rsa4096 2012-05-11 [SC]
      790B C727 7767 219C 42C8  6F93  3B4F  8E5A  9094  86A9
uid           [ unknown] Ubuntu CD Image Automatic Signing Key (2012) <cdimage@ubuntu.com>

/etc/apt/trusted.gpg.d/ubuntu-keyring-2018-archive.gpg
------------------------------------------------------
pub   rsa4096 2018-09-17 [SC]
      F6EC B376 2474 EDA9 D21B  7022  8719  20D1  991B  C93C
uid           [ unknown] Ubuntu Archive Automatic Signing Key (2018) <ftpmaster@ubuntu.com>

/etc/apt/trusted.gpg.d/microsoft.gpg
------------------------------------
pub   rsa2048 2015-10-28 [SC]
      BC52 8686 B50D 79E3  3390  9B8A  0E58  6F4F  2C1B  6E55
uid           [ unknown] Microsoft (Release signing) <gpgsecurity@microsoft.com>

------------------------------------------------------------
Step 4: Run Package Analyzer
------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ chmod +x package_analyzer.py
toor@ip-172-31-10-207:~/supply-chain-lab$ python3 package_analyzer.py
=== Analyzing APT Sources ===

=== Analyzing Pip Configuration ===

=== Security Report ===
Total Issues Found: 3
Security Score: 40/100
Report saved to package_security_report.json

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ cat package_security_report.json
{
    "total_issues": 3,
    "security_score": 40,
    "vulnerabilities": [
        {
            "file": "/etc/apt/sources.list",
            "line": 4,
            "issue": "Source uses HTTP instead of HTTPS",
            "severity": "HIGH",
            "source": "deb http://archive.ubuntu.com/ubuntu noble main restricted universe multiverse"
        },
        {
            "file": "/etc/apt/sources.list",
            "line": 5,
            "issue": "Source uses HTTP instead of HTTPS",
            "severity": "HIGH",
            "source": "deb http://archive.ubuntu.com/ubuntu noble-updates main restricted universe multiverse"
        },
        {
            "file": "/etc/apt/sources.list",
            "line": 6,
            "issue": "Source uses HTTP instead of HTTPS",
            "severity": "HIGH",
            "source": "deb http://security.ubuntu.com/ubuntu noble-security main restricted universe multiverse"
        }
    ]
}

------------------------------------------------------------
Task 2: Network Monitoring
------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ sudo apt update
Hit:1 http://archive.ubuntu.com/ubuntu noble InRelease
Hit:2 http://archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:3 http://archive.ubuntu.com/ubuntu noble-backports InRelease
Hit:4 http://security.ubuntu.com/ubuntu noble-security InRelease
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
18 packages can be upgraded. Run 'apt list --upgradable' to see them.

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ sudo apt install -y net-tools
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following NEW packages will be installed:
  net-tools
0 upgraded, 1 newly installed, 0 to remove and 18 not upgraded.
Need to get 194 kB of archives.
After this operation, 825 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu noble/main amd64 net-tools amd64 2.10-0.1ubuntu4 [194 kB]
Fetched 194 kB in 1s (267 kB/s)
Selecting previously unselected package net-tools.
(Reading database ... 112940 files and directories currently installed.)
Preparing to unpack ...
Unpacking net-tools ...
Setting up net-tools ...
Processing triggers for man-db ...

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ python3 update_monitor.py
Starting network monitoring...
Simulating update check (apt list --upgradable)...
Capturing traffic for 10 seconds...
Monitoring stopped.
Analyzing captured connections...

=== Network Traffic Report ===
Total connections captured: 7
Unique destinations: 5
Suspicious activity found: 2
Report saved to update_traffic_report.json

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ cat update_traffic_report.json
{
    "timestamp": "2026-02-21T14:22:31.102948",
    "total_connections_captured": 7,
    "unique_destinations": [
        "169.254.169.254:80",
        "185.125.190.82:80",
        "91.189.91.38:80",
        "91.189.91.49:80",
        "91.189.91.83:80"
    ],
    "suspicious_activity_count": 2
    ...
}

------------------------------------------------------------
Task 3: TLS Analysis
------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ python3 tls_analyzer.py
=== TLS Analysis ===
Analyzing: archive.ubuntu.com
Analyzing: security.ubuntu.com
Analyzing: pypi.org
Analyzing: github.com

=== TLS Security Report ===
Servers analyzed: 4
HIGH severity issues: 0
MEDIUM severity issues: 1
LOW severity issues: 3
Report saved to tls_security_report.json

------------------------------------------------------------
Task 4: Integrated Audit
------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ python3 supply_chain_auditor.py
=== Analyzing APT Sources ===

=== Analyzing Pip Configuration ===

Starting network monitoring...
Simulating update check (apt list --upgradable)...
Capturing traffic for 10 seconds...
Monitoring stopped.

Audit complete! Review the generated reports.

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ ls -la
total 100
drwxr-xr-x 2 toor toor  4096 Feb 21 14:26 .
drwxr-xr-x 9 toor toor  4096 Feb 21 14:13 ..
-rwxr-xr-x 1 toor toor  4281 Feb 21 14:18 package_analyzer.py
-rw-r--r-- 1 toor toor  1229 Feb 21 14:18 package_security_report.json
-rwxr-xr-x 1 toor toor  7422 Feb 21 14:22 update_monitor.py
-rw-r--r-- 1 toor toor  3897 Feb 21 14:22 update_traffic_report.json
-rwxr-xr-x 1 toor toor  6730 Feb 21 14:24 tls_analyzer.py
-rw-r--r-- 1 toor toor  6021 Feb 21 14:24 tls_security_report.json
-rwxr-xr-x 1 toor toor 18742 Feb 21 14:26 supply_chain_auditor.py
-rw-r--r-- 1 toor toor  1412 Feb 21 14:26 supply_chain_audit_report.json
-rw-r--r-- 1 toor toor   675 Feb 21 14:26 supply_chain_audit_report.txt

------------------------------------------------------------
toor@ip-172-31-10-207:~/supply-chain-lab$ cat supply_chain_audit_report.txt
Comprehensive Supply Chain Security Audit Report
=======================================================
Timestamp: 2026-02-21T14:26:18.204114
Overall Score: 63.0
Risk Level: HIGH

Category Scores
-------------------------------------------------------
Package Security Score: 40
Network Security Score: 70
TLS Security Score: 90

Recommendations
-------------------------------------------------------
- Replace any HTTP APT/pip sources with HTTPS and remove insecure repositories.
- Investigate flagged network connections and enforce HTTPS-only update endpoints where possible.
- Improve TLS posture: ensure forward secrecy, strong ciphers, and monitor certificate expiry.

Report Files Generated
-------------------------------------------------------
- package_security_report.json
- update_traffic_report.json
- tls_security_report.json
- supply_chain_audit_report.json
